# 부하분산
## 1. ELB(Elastic Load Balancing)
### 1. ELB(Elastic Load Balancing)란?
#### 1. 고가용성 환경 구성
- 지속적인 서비스 제공을 위해 서버를 다중화 구성하여 서비스의 연속성을 보장하는 고가용성 구성이 필요.
  - 로드밸런서를 통해 해결
````
#단일 서버
사용자 -> 인터넷 -> 서버1(장애)
- 서비스 불가 상태 

#다중 서버 
사용자 -> 인터넷 -> 서버1(장애)
               -> 서버2(대체)
- 서버2번으로 대체하여, 서비스 가능
````

#### 2. ELB 정의
- ELB : `AWS 에서 제공하는 로드 밸런싱 기술`
  - EC2 인스턴스의 상태를 확인하고 데이터를 분산해준다.
- 로드밸러서는 자신이 `서비스하는 대상을 정의하는 "리스너"`와 `부하분산 대상을 정의하는 "대상 그룹"`으로 이루어져 있다.
````
로드 밸런서 구성(리스너와 대상 그룹)
         | ------ 로드밸런서 영역 ------ |  
인터넷 -> | 리스너(Rule)         대상그룹 |  keepalive 대상1(EC2) 
         |                              |  keepalive 대상2(EC2)
             ↑                    ↑      
       부하분산 서비스 정의   부하분산 대상 그룹 정의
````
- 로드밸런서
  - 리스너 : 프로토콜 및 포트를 사용하여 `연결 요청을 확인하는 프로세스`
  - 대상그룹 : 대상그룹에 속한 대상에 주기적으로 확인하는 `프로세스(keepalive)`를 통해 `상태 확인(health check)을 수행`하며, `정상적인 대상`에게만 데이터를 전달한다.

#### 3. ELB 종류
1. **ALB** : Application Load Balancer (OSI 7계층)
   1. `HTTP` or `HTTPS` 와 같은 `웹 애플리케이션에 대한 분산 처리` 제공
2. **NLB** : Network Load Balancer (OSI 4계층)
   1. `TCP` or `UDP` 프로토콜에 대한 포트 정보를 정의하여 네트워크 기반의 분산 처리를 제공하는 로드밸런서
3. CLB : Classic Load Balancer
   1. VPC의 예전 버전인 EC2-Classic에서 분산처리르 제공하는 이전세대의 로드밸런서

※일반적인 VPC 환경에서는 ALB 또는 NLB를 사용 하는것이 좋다.

#### 4. ALB vs NLB
- **ALB** : Application Load Balancer (OSI 7계층)
  - HTTP, HTTPS에 특화된 어플리케이션 레벨의 로드밸런서
  - 다른 로드 밸러서에 비해 처리 속도가 조금 느릴수 있다.
  - URL 경로기반 라우팅, 호스트 기반 라우팅, HTTP 헤더 기반 라우팅등 다양한 규칙을 생성하여 포워드(forward), 리다이렉션(re-direction), 지정 HTTP 응답 등의 작업을 수행할 수 있다.
  - Lambda 함수를 호출하여 HTTP 요청도 처리할 수 있다.
- **NLB** : Network Load Balancer (OSI 4계층)
  - TCP, UDP, TLS 프로토콜에 대하여 로드밸런싱을 수행
  - 가장 빠른 처리속도
  - 고정 IP, 탄력적 IP를 보유할 수 있다.
  - VPC 엔드포인트 서비스로 연결하여 프라이빗 링크를 구성할 수 있다.

#### 5. ELB 통신방식
- 통신방식 2가지
  - 인터넷 연결(Internet Facing Load Balancer)
    - 퍼블릭 주소를 가지고 있어, 인터넷을 통해 요청을 로드 밸런서에 등록된 EC2 인스턴스로 라우팅
    
     ![1](/images/ch5/1.png)
  - 내부(Internet Load Balancer)

#### 6. ELB 특징
1. 고가용성 : ELB로 인입되는 트래픽을 다수의 대상으로 분산하여 `고가용성`을 유지한다.
2. 상태확인 : 대상 그룹에 대한 Keepalive를 통해 주기적으로 상태를 확인한다.
3. 보안기능 : 보안그룹(Security Group)을 적용하여, 보안 옵션을 부여한다.(단, NLB는 보안 그룹이 적용되지 않음)
4. 4계층/7계층 로드밸런싱 : HTTP(S)의 7계층 애플리케이션 로드밸런싱 or TCP/UDP 4계층 로드밸런싱 지원한다.
5. 운영 모니터링 : ELB 애플리케이션 성능을 실시간으로 모니터링할 수 있다.

## 2. [5-1]실습 ALB와 NLB를 통한 로드 밸런싱
## 3. Route 53
### 1 DNS(Domain Name System)
#### 1. 개요
- DNS : 복잡한 주소 체계를 문자 형태의 도메인 네임으로 매핑하여 연결하는 서비스
#### 2. DNS 서버 분류
- 4가지 유형이 있다.

1. DNS 해석기(DNS Resolver)
 - 클라이언트와 네임 서버의 중계자 역할. `DNS 요청에 대해 네임 서버로 전달`, `DNS 응답을 클라이언트에게 전달`한다.
2. 루트 네임 서버(Root Name Server)
 - DNS 서버의 최상위 네임 서버로, DNS 해석부터 발생항 DNS 요청에 대해 `적절한 TLD 네임서버 정보를 반환`한다.
3. TLD 네임서버(Top Level Domain Name Server)
 - .com, .net 과 같은 `최상위 도메인에 대한 네임 서버`로 해당 영역에 포함되는 모든 도메인 이름의 정보를 유지한다. DNS 요청에 대해 TLD 네임 서버에 권한 있는 네임서버를 지정하여 반환한다.
4. 권한 있는 네임서버(Authoritative Name Server)
 - DNS 해석기가 TLD 네임 서버로부터 응답을 받으면, 확인자는 해당 응답을 권한 있는 네임서버로 보낸다. 일반적으로 권한 있는 네임 서버는 요청하는 도메인 주소에 대한 IP주소를 확인하는 마지막 단계이다.

#### 3. DNS 레코드 유형
- 도메인에 관한 설정을 하기 위해 사용되는 일련의 문자들이다.
````
레코드 A : IPv4 주소를 매핑
레코드 AAAA : IPv6 주소를 매핑
CNAME : 도메인 이름의 별칭을 만듬
MX : 이메일 서버 지정
NS : 도메인 네임 서버 식별
SOA : 도메인 영역을 표시하는 역할
SRV : 도메인 서비스 이용 가능여부 식별
TXT : 텍스트 매핑
````

### 2. Route 53 소개
#### 1. Route 53 개요
- AWS 에서 제공하는 관리형 DNS 서비스이다.
- Route53을 통해 `도메인 이름을 구매` 및 대행, `구매한 주소에 대한 호스팅 영역을 생성`, `네임서버 구축 및 레코드 생성`하여 `DNS 요청에 대한 응답을 처리`한다.
````
AWS Route53 서비스 구조

도메인 이름 등록 -> 호스팅 영역(퍼블릭/프라이빗 호스팅) -> 라우팅 정책   ->  레코드 (CNAME)
                        |                           -> 라우팅 정책   ->  레코드 (A)
                  네임 서버                          -> 라우팅 정책   ->  레코드 (NS)
                  - abc.abc.com
                  - asd.asd.org
                  - fff.ddd.net 
                  
1. 도메인 이름 등록
- Route53을 통해 도메인 이름 등록, TLD 네임서버에 전파하여, 해당 도메인 이름을 사용할 수 있도록 대행한다.
2. 호스팅 영역
- DNS 관리를 할 수 있는 호스팅 영역을 생성할 수 있다. 기본적으로 Route53을 통해 도메인 이름을 등록하면 자동으로
  호스팅 영역이 생성왼다. '호스팅 영역이 생성되면 네임서버가 생성'되어 'DNS 요청에 대한 DNS 응답을 반환'한다.
3. 레코드
- 생성한 호스팅 영역에 레코드를 작성할 수 있다. 레코드를 생성할 땐 다양한 라우팅 정책을 수립할 수 있다.
 
````
````
DNS 서비스 통신흐름
클라이언트 -> asd.com 요청 -> DNS 해석기 <-> 루트 네임서버에서 TLD 네임서버 반환
                             DNS 해석기 <-> 반환받은 TLD 네임서버에 권한있는 네임서버 요청
                             DNS 해석기 <-> 반환받은 권한있는 네임서버에 IPv4를 응답
                             DNS 해석기 <-> 반환받은 IPv4 주소를 도메인명으로 변경하여 클라이언트에 전달
                             
                             최종적으로 클라이언트는 해당 도메인으로 request를 보냄.
                             
※ P.223 : [그림 3-2-2]DNS 서비스 통신흐름
````
#### 2. Route53 라우팅 정책
- 단순라우팅(Simple Routing)
  - 도메인에 대해 특정 하나의 리소스를 지정한다. 레코드에 대한 값은 여러 개를 입력할 수 있으나, 이중에 하나의 값만 랜덤하게 응답한다.  
  - 도식화  
    ![1](/images/ch5/simple.png)
- 가중치 기반 라우팅(Weighted Routing)
  - 도메인에 대해 다수의 리소스를 지정하고 값에 대한 비중을 두고 라우팅을 한다. 가중치 값은 `0~255 사이 설정` 가능하다. `0 이면 DNS 응답을 하지 않는`다.
  - 도식화  
    ![1](/images/ch5/weighted.png)
- 지연 시간 기반 라우팅(Latency Routing)
  - 여러 AWS 리전에 리소스가 있고 최상의 지연 시간을 제공하는 리전으로 라우팅한다.
  - 도식화  
    ![1](/images/ch5/latency.png)
- 장애 조치 라우팅 정책(Failover Routing)
  - 장애조치를 구성하려는 경우에 사용한다. 주기적인 상태 확인을 통해 액티브 리소스가 통신이 불가능할 경우 패시브 대상을 액티브 대상으로 변경하여 해당 경로로 라우팅한다.
  - 도식화  
    ![1](/images/ch5/failover.png)
- 지리 위치 라우팅(Geolocation Routing)
  - DNS 질의를 하는 사용자의 로컬 DNS 서버의 IP를 기반으로 가장 인접한 리전의 리소스를 대상으로 라우팅해준다.
- 지리 접근 라우팅(Geoproximity Routing)
- 다중값 응답 라우팅(Multi-value Answer Routing)

#### 3. Route53 주요기능
- 도메인등록
  - Route53은 도메인 이름 등록서비스를 제공. 사용 가능한 도메인 이름을 검색 및 등록, 도메인 등록 대행소 역할을 수행한다.
- 상태 확인 및 모니터링
  - 다양한 리소스의 상태와 성능과 지표를 모니터링 할 수 있다.
- DNS 장애 조치
  - 사이트 중단이 발생하지 않도록 사용자에게 대체 가능한 경로로 자동 라우팅한다. 주기적인 상태 확인을 통해 정상적인 서비스를 구분한다.
- 라우팅 정책
  - 다양한 라우팅 정책을 제공한다.
- Alias(별칭)
  - AWS 서비스의 도메인 이름에 대한 별칭을 지정할 수 있다. ELB, CloudFront, S3 버킷 등의 도메인을 매핑할 수 있다.
- Route 53 Resolver
  - 조건부 전달 규칙 및 DNS 엔드포인트를 생성하여 Amazon Route 53 프라이빗 호스팅 영역과 온프레미스 DNS 서버 간에 도메인 질의를 할 수 있다.
- VPC용 프라이빗 DNS
  - DNS 데이터를 퍼블릭 인터넷에 노출하지 않고, 내부 AWS 리소스에 대한 사용자 지정 도메인 이름을 관리한다.

#### 4. 도메인 이름 생성
1) Route 53을 도메인 등록 대행소로 활용
2) 무료 DNS 제공 사이트를 도메인 을고 대행소로 활용

## 4. [5-2] Route 53 구성 및 라우팅 정책
- 목표 : AWS 클라우드 네트워크 구성, Route 53의 도메인을 활용하여 연결 실습, 장애 조치 라우팅 정책을 통해 Failover 구성

## 5. CLoudFront
## 6. [5-3] CloudFront를 통한 CDN 서비스
## 7. Global Accelerator
## 8. [5-4] 글로벌 네트워크를 활용한 Global Accelerator
