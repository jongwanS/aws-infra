# 인터넷 연결
## 1. AWS의 인터넷 연결
### 1. AWS의 인터넷 연결 소개
- `AWS PVC 내부 -> 외부 인터넷으로 연결을 위한 방법 소개`

#### 1. 인터넷 연결을 위한 4가지 조건
````
1. 인터넷 게이트웨이
 - 외부 인터넷과 연결을 해주는 장비
2. 네트워크 라우팅 테이블 정보(외부와 네트워크 통신을 위한)
 - 목적지로 가기 위한 지도정보로, 모든 네트워크 대역(0.0.0.0/0)통신은 인터넷 게이트웨이로 전달하기 위해 경로로 지정
3. 공인IP
 - 일종의 유일한 주소개념
 - AWS에서 사용 가능한 공인 IP는 Public IP와 탄력적IP가 있다.
4. 보안 그룹과 네트워크 ACL
 - 보안 그룹과 네트워크 ACL에 의해 외부 네트워크와 통신이 허용되어야 한다.
````
#### 2. NAT 동작방식
1. PC1(192.168.1.1)과 PC2(192.168.1.2)는 private IP를 갖고 있으며, 외부 웹서버(60.1.1.1)를 연결 시 출발지 IP는 프라이빗 IP로 지정되어, IP공유기로 향한다.
2. IP 공유기는 출발지 IP(프라이빗IP)를 인터넷이 가능하도록 IP 공유기 자신에게 할당된 퍼블릭IP를 출발지 IP로 변환하여 웹서버로 연결한다.

- 이처럼 IP를 변환하는 것을 NAT(Network Address Translation)이라 부르며, IP와 포트를 동시에 변화하는 것을 PAT(Port Address Translation)이라고 부른다.

#### 3. 인터넷 연결을 위한 3가지 방안 비교
1. 인터넷 게이트웨이
   1. Layer3 계층 동작
   2. 프라이빗 IP를 -> 퍼블릭 IP or 탄력적 IP로 1:1 주소 전환
   3. 특징 : 1개의 프라이빗IP 마다 1개의 공인IP 매칭
2. NAT 디바이스
   1. Layer4 계층 동작
   2. IP 주소와 포트 번호 변환
   3. 여러 개의 프라이빗IP가 1개의 공인IP 사용가능
3. Proxy 인스턴스
   1. Layer7 계층 동작
   2. IP 주소와 포트 번호 변환(TCP 신규연결)
   3. 어플리케이션 수준 제어 가능

### 2. 인터넷 게이트웨이
#### 1. 인터넷 게이트웨이(Internet Gateway) 소개
- VPC와 인터넷 간에 통신을 할수 있게 해준다.
- 인터넷 게이트웨이는 퍼블릭 IPv4 주소가 할당된 인스턴스에 대해 1:1 IPv4주소 변환을 수행한다.
  - 인터넷 게이트웨이는 IPv4, IPv6을 지원한다.

#### 2. 인터넷 게이트웨이를 통한 외부 접속
- 인터넷 게이트웨이는 퍼블릭 IP 혹은 탄력적 IP에 대해 1:1 IP NAT(프라이빗IP -> 퍼블릭IP)를 수행한다.
- 외부 접속시 프라이빗 IP -> 퍼블릭 or 탄력적 IP로 변환, 내부 접속시 퍼블릭or탄력적IP -> 프라이빗IP로 변환
※참고 : 퍼블릭 IP, 탄력적 IP는 1:1 프라이빗 IP와 연결되기 때문에, 해당 IP를 독점적으로 사용하는것과 유사하다.

#### 3. 인터넷 게이트웨이 제약사항
- 하나의 VPC에는 한 개의 인터넷 게이트웨이만 사용 할 수 있다.
- 리전 당 VPC의 기본 할당량은 5개이며, AWS 케이스 오픈을 통해 리전당 최대 100개까지 증가 할 수 있다.

### 3. NAT 디바이스(NAT 인스턴스 & NAT 게이트웨이)
#### 1. NAT 디바이스 소개
- NAT 디바이스 : `NAT 인스턴스` 와 `NAT 게이트웨이`를 통칭하여 NAT 디바이스라고 말한다.
- 프라이빗 서브넷에 있는 인스턴스를 NAT 디바이스를 통하여 외부 인터넷 또는 AWS 퍼블릭 서비스에 연결할 수 있도록 해준다.
- 내부(AWS 인스턴스)에서 외부 인터넷으로 통신만 가능, 인터넷 게이트웨이와는 다르게 외부 인터넷에서 내부 AWS 구간으로의 직접 통신은 불가능 하다.

#### 2. NAT 게이트웨이와 NAT 인스턴스 비교
- NAT 게이트웨이
  - 유지관리 :AWS에서 유지관리
- NAT 인스턴스(소규모에 적합)
  - 유지관리 : 사용자가 직접관리

#### 3. NAT 인스턴스를 통한 외부 접속
- P.180

#### 4. NAT 게이트웨이 제약 사항
- 5Gbps 대역폭 지원, 최대 45Gbps까지 자동 확장
- 단일대상에 대해 분당 최대 55,000개의 동시 연결을 지원
- NAT 게이트웨이 가용 영역당 기본 할당 5개, 그이상시 AWS 케이스 오픈을 통해 증가요청 가능

### 4. Proxy 인스턴스
#### 1. Proxy 인스턴스 소개
- 클라이언트와 서버 중간에 통신을 대신 처리

#### 2. Proxy 인스턴스를 통한 외부 접속
- 프라이빗 서브넷 내부의 인스턴스는 HTTP 통신을 위해 목적지 IP는 Proxy 인스턴스로 향한다. 이후 Proxy 인스턴스는 결과를 다시 내부 인스턴스로 보낸다.

## 2. [실습4-1] NAT 인스턴스를 통한 인터넷 연결
- NAT 인스턴스를 통하여 프라이빗 서브넷에 인스턴스가 외부 인터넷으로 통신을 가능하게 설정

