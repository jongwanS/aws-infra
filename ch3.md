# VPC 고급
## 1. VPC 엔드포인트
### 1. VPC 엔드포인트 란?
#### 1) VPC 엔드포인트 개요
- VPC 엔드포인트는, 외부 인터넷 구간을 통한 접근이 아닌 직접적으로 접근할 수 있는 `프라이빗 액세스` 기능이다.
- 예를들어, VPC가 S3스토리지에 접근시 외부 인터넷을 통해 접근하는것이 아닌, `VPC 엔드포인트` 기능을 통해 `내부 프라이빗 연결`을 한다.
#### 2) VPC 엔드포인트 유형
1. 엔드포인트
- AWS `퍼블릭 서비스 대상`을 연결
- 2가지 유형
  - `게이트웨이 엔드포인트` : AWS 퍼블릭 서비스 중 S3와 DynamoDB에 대한 연결
  - `인터페이스 엔드포인트` : 그외 AWS 퍼블릭 서비스에 대한 연결

2. 엔드포인트 서비스
- 사용자가 직접 생성한 서비스에 대해 `프라이빗 연결` 

※ VPC 엔드포인트 유형 중, `인터페이스 엔드포인트`, `엔드포인트 서비스`를통한 연결을 AWS에서는 `프라이빗 링크`라고 부른다. 

#### 3) VPC 엔드포인트 특징
1. 보안 측면 강화
   - 프라이빗 연결을 통해 외부구간으로 노출되지 않는다.
2. 서비스 제약
   - 연결 대상 서비스는, 동일 리전에 속한 서비스만 가능
3. VPC 종속
   - 오직 하나의 VPC에만 연결할 수 있다.
4. 권한제어
   - AWS IAM 기능을 통해, VPC 엔드포인트 권한 부여가능

## 2. 게이트웨이/인터페이스 엔드포인트 비교 (실습)
- 목표 : VPC 엔드포인트의 `게이트웨이 엔드포인트`, `인터페이스 엔드포인트` 기능을 활용, AWS 서비스에 프라이빗 연결 확인 및 통신 과정 확인
- 목표 구성도  
![1](/images/ch3/2.png)

## 3. 엔드포인트 서비스로 프라이빗 링크 구성 (실습)

### 1) 게이트웨이 엔드포인트
1. 게이트웨이 엔드포인트 생성
2. 게이트웨이 엔드포인트 검증
   1. 퍼블릭/프라이빗 EC2 에서 S3와 통신하기 위해 데이터를 가상 라우터로 전달
   2. 라우팅 테이블을 참고하여, 게이트웨이 엔드포인트로 향하는 라우팅 경로를 확인하여, 전달
   3. 게이트웨이 엔드포인트를 통해 S3로 데이터가 전달되며, 정상적으로 퍼블릭/프라이빗 서브넷 둘다 통신이 된다.  
   ![1](/images/ch3/3.png)
3. 인터페이스 엔드포인트 생성
   1. 기본적으로 AWS는 리전별로 기본 DNS 호스트 주소를 갖고 있다. 
       
4. 인터페이스 엔드포인트 검증
   ````
   AWS 서비스에 VPC 인터페이스 엔드포인트를 연결하면
   DNS A : 기본 DNS 호스트
   DNS B : 엔드포인트 전용 DNS 호스트
   ````
   #### - 인터페이스 엔드포인트의 프라이빗 DNS 설정에 따른 통신 흐름
   ![1](/images/ch3/4.png)
   ````
   1. 퍼블릭 EC2 인스턴스, 프라이빗 EC2 인스턴스에서 CloudFormation과 통신하기 위해 데이터를 인터페이스 엔드포인트로 전달한다.
   2. 인터페이스 엔드포인트를 통해 CloudFormation으로 전달한다.
   ````
    - 프라이빗 DNS 비활성화
        - 기본DNS 호스트 : 인터넷 구간을 통한 퍼블릭 통신
        - 엔드포인트 전용 DNS 호스트 : 인터페이스 엔드포인트를 통한 프라이빗 통신
    - 프라이빗 DNS 활성화
        - 기본DNS 호스트 : 인터페이스 엔드포인트를 통한 프라이빗 통신
        - 엔드포인트 전용 DNS 호스트 : 인터페이스 엔드포인트를 통한 프라이빗 통신

### 2) 엔드포인트 서비스로 프라이빗 링크 구성
- 실습목표 : 엔드포인트 서비스 기능을 활용, 사용자가 생성한 VPC와 프라이빗 연결을 확인하고 통신되는 과정을 살펴보자
- 실습단계
- 목표 구성도

## 4. 배치 그룹(Placement Group)
- 새로운 인스턴스가 시작되면 AWS에서는 하드웨어에 최대한 분산하여 배치
  - 물리 호스트의 장애에 대해 상호 간 영향도를 최소화하고 장애를 줄이는 데 도움이 되기 때문
  - 워크로드(workload)에 따라 인스턴스의 배치 위치를 조정하는 것이 유리한 경우도 있다.
    - 배치그룹(Placement Group)은 그룹 내 인스턴스의 배치를 조정하는 기능

#### 1. 배치 그룹 종류
- 3가지 전략
  1. 클러스터 배치 그룹
     1. 인스턴스의 하드웨어 배치를 서로 근접하게 위치(낮은 지연시간, 높은 네트워크 성능)
  2. 파티션 배치 그룹
  3. 분산형 배치 그룹

## 5. 메타데이터(Metadata)
#### 1. 메타데이터란?
- 객체에 대한 키(key & value)와 값에 대한 집합데이터

#### 2. EC2 인스턴스 메타데이터 확인
- {ec2-domain-path}/latest/meta-datda/{admi-id, hostname, instance-id, security-groups} 등 확인가능