# VPC 기초
![1](/images/ch2/ch2.1.PNG)
## 1. VPC(Virtual Private Coloud)
### 1. VPC란(독립된 가상의 클라우드 네트워크)
#### 1) VPC 정의 
 - `AWS 클라우드 내 논리적인 독립적 섹션`, 사용자가 정의한 네트워크상에서 AWS 리소스 실행
 - IP대역, 인터페이스, 서브넷, 라우팅 테이블, 인터넷 게이트웨이, 보안 그룹, 네트워크 ACL 등 생성/제어

#### 2) VPC 종류
 - 기본 VPC
   - AWS에 이미 리전별로 1개씩 생성되어 있음.
 - 사용자 VPC
   - 수동으로 생성, 최대 5개(기본 값)

### 2. VPC 특징
````
확장성 : 클라우드 기반, 손쉽게 VPC 생성/삭제
보안 : 인스턴스 레벨, 서브넷 레벨에서 인바운드 및 아웃바운드 필터링 수행, 보안그룹/네트워크 ACL 제공 보안 강화
사용자 중심 : VPC 내 리소스 사용자가 손쉽게 제어, 모니터링 툴등 사용자에게 높은 가시성
제약 사항 : 기술적 제약이 있음(브로드캐스트, 멀티캐스트, VRRP, HSRP 등) 
````

## 2. 기본 네트워크 개념 이해

### 1. OSI 7 레이어 모델

#### 1) OSI 7 레이어 모델 개념
- 국제표준화기구(ISO) 에서 개발한 모델, 복잡한 네트워크 동작을 7개의 계층으로 나눠서 설명한다.    

  ![1](/images/ch2/osi7.png)

````
OSI 7계층

1. Physical 계층 : 물리계층, 네트워크 하드웨어 전송기술(물리적인 링크,연결,유지 해제 담담)
2. Data Link 계층 : Physical 계층에서, 송수신되는 정보의 오류와 흐름을 관리, 데이터 전달 수행
3. Network 계층 : 데이터를 목적지까지 빠르고 안전하게 전달(라우팅), 노드를 거칠 때마다 최적의 경로를 찾아주는 역할.
4. Transport 계층 : 종단의 사용자 간 데이터를 옮겨주는 최상위 계층(데이터의 유효성, 효율성 보장)
5. Session 계층 : 종단의 사용자 간의 응용 프로세스 통신을 관리하기 위한 방법을 제공.
6. Presentaion 계층 : 송/수신자간 이해할 수 있는 형태로 데이터를 표현하는 기능을 담당(데이터 암호화 및 압축)
7. Application 계층 : 응용 프로세스와 직접 연계, 실제 응용 프로그램을 사용하게 하는 계층

````
### 2. IP와 서브넷 마스크

#### 1) IP 개념
- IP : 인터네상의 네트워크 자원을 구분하는 주소(network 계층)
  - IPV4 : 주소길이 32bit, 약 43억개 주소 표현 가능
  - IPV6 : 주소길이 128bit, 약 43억 x 43억 x 43억 x 43억개 표현가능

#### 2) 퍼블릭 IP와 프라이빗 IP
- 퍼블릭 네트워크, 프라이빗 네트워크가 사용하는 IPv4 주소 대역은 지정되어 있다.
- 퍼블릭 IP(공인 IP)
  - ISP(KT,LG 등등) 에서 제공하는 IP 주소
  - 퍼블릭 IP는 `전세계에서 유일`한 주소를 갖는다. 
- 프라이빗 IP(사설 IP)
  - 일반 가정, 회사등 독립된 네트워크에서 사용하는 `내부 IP`주소이다.
  - `독립된 네트워크상`에서 유일한 주소를 갖는다.
  - 3가지 대역(class)로 고정되어있다.
  - Class A : 10.0.0.0 ~ 10.255.255.255  
    Class B : 172.16.0.0 ~ 172.31.255.255  
    Class C : 192.168.0.0 ~ 192.168.255.255

#### 3) 서브넷과 서브넷 마스크
- 서브넷 : 부분적인 독립된 네트워크
- 서브넷 마스크 : 서브넷을 서로 구분하기위해 사용되는 방법(32bit)
  - IP주소에 네트워크 ID, 호스트 ID로 구성된다.
    - 네트워크 ID : 서브넷을 식별
    - 호스트 ID : 서브넷 안에서 대상을 식별
    - ````
      이진수 값이1이면 네트워크ID, 0인 영역이 호스트 ID다.
      11111111.11111111.11111111.00000000
      <------- 네트워크 ID -----> <-호스트 ID->
      255.255.255.0 으로 표현하거나, /24 형태로 표현(24는 1의 갯수, 네트워크 ID의 비트수)
      
      10.1.2.3 /16
      10.1.3.1 /16
      10.1까지 동일 서브넷
      10.1.2와 10.1.3 으로 나뉘므로, 그 이후로는 다른 서브넷이다.
      ````   
- 이렇게 네트워크 영역을 구분, 비교하여 서로 동일 서브넷인지 아닌지 판단할 수 있다.
  - `IP CIDR(Classless Inter Domain Routing)` 표기법
    - 10.0.0.0/8, 10, 10.1.0.0/16, 10.1.1.0/24

### 3. TCP와 UDP 그리고 포트 번호
#### 1) TCP, UDP
- TCP : Transport 계층(4), 연결 지향, 신뢰성 보장, 데이터 순서 보장
  - HTTP, SSH, FTP
- UDP : Transport 계층(4), 비연결 지향, 신뢰성 보장X, 데이터 순서보장 X
  - DNS, DHCP

#### 2) 포트 번호
- 서비스를 구분할 때 포트 번호를 통해 구분한다.
- 포트는 범위에 따라 크게 3개로 나뉜다.
  - Well-Known Port : 0 ~ 1023
  - Registed Port : 1024 ~ 49151
  - Dynamic Port : 49152 ~ 65535
- TCP 포트는 80번(Well-Known Port), DNS 서비스 포트는 53(Well-Known Port)

### 4. DHCP(Dynamic Host Configuration Protocol)
#### 1) DHCP 개념
- 동적으로 IPv4 주소를 일정 기간 임대하는 프로토콜
- UDP 프로토콜을 사용
- 포트는 67과 68번을 사용한다.

#### 2) DHCP 절차
- 중앙집중형 서버/클라이언트 방식으로 동작
- DHCP 서버가 존재, 네트워크 호스트가 클라이언트가 되어 IP할당을 요구함.
````
DHCP Client               DHCP 서버

     DHCP client 가 서버를 찾음.
   --------------------------->
   DHCP 서버가 IP와 임대시간 알려줌
   <---------------------------
   DHCP 서버에게 해당 IP 할당 요청
   --------------------------->
     DHCP 서버가 OK 사인을 보냄
   <---------------------------
````

### 5. DNS(Domain Name System)
#### 1) DNS 개념
- IP주소의 복잡한 주소 체계를 해소하기 위해 문자 형태로 구성된 이름.
- UDP 프로토콜 사용
- 포트번호는 53번을 사용한다.

### 6. 라우팅(Routing)
#### 1) 라우팅 개념
- 라우팅 : 네트워크 통신을 수행할 때 경로를 잡아주는 계층이다.(Network 계층, 3계층)
  - 연결된 네트워크 망에서 최적의 경로를 잡아 통신해준다.

#### 2) 라우터와 라우팅 테이블
- 라우팅을 수행하는 `장비`를 라우터라고 하며, 라우터는 `라우팅 테이블`을 통해 경로를 파악, 목적지로 데이터를 전달
- 라우터는 라우팅 테이블을 통해 목적지 IP로 데이터를 전달한다.

## 3. VPC 리소스 소개

### 1. 서브넷
#### 1) 서브넷 개념
- 서브넷 : `네트워크 영역을 부분적으로 나눈 망`이다.
- 클라우드 환경의 VPC에서도 서브넷을 통해 네트워크를 분리할 수 있다.  
- `서브넷의 IP 대역은 VPC의 IP대역에 속해 있어야한다`.  

![1](/images/ch2/subnet.png)  

- AWS에서 서브넷IP를 할당할때, AWS에서 예약된 IP를 제외하고 할당해야한다.
  - 예약된 IP
    - ````
      예를들어, 서브넷에 할당될 IP 대역이 10.0.0.0/24 이면, 
      10.0.0.0 ~ 10.0.0.255
      첫번재 주소 : 10.0.0.0 (네트워크 주소)
      두번째 주소 : 10.0.0.1 (AWS VPC 가상 라우터 주소)
      세번째 주소 : 10.0.0.2 (AWS DNS 서버주소)
      네번재 주소 : 10.0.0.3 (향후 새로운 기능에 활용할 주소)
      마지막 주소 : 10.0.0.255 (네트워크 브로드캐스트 주소)
      ````

#### 2) 퍼블릭 서브넷과 프라이빗 서브넷
- 서브넷은 `퍼블릿 서브넷`, `프라이빗 서브넷` 으로 나뉜다.
  - 퍼블릿 서브넷 : 공인 네트워크 개념, `외부 인터넷 구간과 직접 통신`
    - 퍼블릭 IP를 가지고 인터넷 게이트웨이를 통해 외부와 연결
  - 프라이빗 서브넷 : 폐쇄적인 네트워크, `외부 인터넷 과 통신 X`
    - 프라이빗 IP를 퍼블릭 IP로 변환해 주는 NAT 게이트웨이를 통해 통신이 가능하긴 하다.

### 2. 가상 라우터와 라우팅 테이블
- VPC를 생성하면, 자동으로 가상 라우터가 생성되며, 이 가상 라우터는 라우팅 테이블을 가지고 있어, 목적지 네트워크로 라우팅하여 통신한다.  
- 가상 라우터는 최초에 기본 라우팅 테이블만 보유하며, 로컬 네트워크에 대한 라우팅 경로만 잡혀 있다.
  
![1](/images/ch2/routingtable.png)  
- 서브넷 당 라우팅 테이블 매핑  
  - 서브넷별로, 라우팅 테이블을 매핑 시킬수 있다.

![1](/images/ch2/virtualroutingtable.png)

### 3. 인터넷 게이트웨이
- 인터넷 게이트웨이는 `VPC와 인터넷 간의 논리적인 연결`이다.
- `VPC에서 인터넷 구간으로 나가는 관문`
- 인터넷 게이트웨이(IGW)는 `VPC`당 `1개`만 가능하다.
  - 즉, 퍼블릿 IP를 사용하는 서브넷의 자원이다.
  - 퍼블릭 서브넷은 자신의 라우팅 테이블에 외부 인터넷 구간으로 나가는 타깃을 `인터넷 게이트웨이`로 지정해줘야 한다.
  - `인스턴스에는 퍼블릭 IP가 부여`되어야 하며, 가상라우터 인터넷 게이트웨이를 거쳐 통신한다.

![1](/images/ch2/igw.png)

### 4. NAT 게이트웨이
- NAT 게이트웨이도 외부 인터넷 구간과 연결하는 관문 역할을 한다.
  - Network Address Translation
- NAT 게이트웨이는 프라이빗 IP를 퍼블릭 IP로 변환하여 통신을 도와준다.
- 프라이빗 서브넷에서 외부 인터넷 통신은 가능하지만, 그 반대는 불가능 하다.   
- AWS에서 NAT 기능은 `NAT 게이트웨이`, `NAT 인스턴스`로 구분 짓는다. (4장에서 딥하게)

![1](/images/ch2/NAT.png)

### 5. 보안 그룹과 네트워크 ACL
- VPC는 `인스턴스 레벨`, `서브넷 레벨` 에서 대상을 필터링 할 수 있는 보안 기술을 사용할 수 있다.
- 인트턴스 레벨에서의 보안 기술 : `보안그룹(Security Group)`
- 서브넷 레벨에서의 보안 기술 : `네트워크 ACL(Access Control List)`

![1](/images/ch2/security.png)


## 4. 실습, 퍼블리 서브넷 VPC 구성

## 5. 실습, 프라이빗 서브넷 VPC 구성